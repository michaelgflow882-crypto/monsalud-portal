<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Monsalud WiFi Hotspot</title>
  <link rel="stylesheet" href="static/base.css">
</head>
<body>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="topbar">
    <div class="logo-text">Monsalud WiFi Hotspot</div>
    <div id="menuBtn" class="menu-btn">‚ò∞</div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SIDEBAR (LEFT SIDE) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <img id="fbPic" src="https://i.ibb.co/7G5N6hS/user.png" class="user-icon" alt="User">
      <div class="user-label" id="fbName">Logged in as User</div>
    </div>
    <ul class="side-list">
      <li>üìú Voucher History</li>
      <li>üì± My Device</li>
      <li>üèÜ Leaderboard</li>
      <li id="sideMyPoints">‚≠ê My Points</li>
      <li>üé° Spin &amp; Win</li>
      <li>üì© Contact Support</li>
    </ul>
  </aside>

  <div id="overlay" class="overlay"></div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HERO / INFO (RIGHT) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="hero">
    <div class="sub" id="greetingText">Good afternoon üå§Ô∏è</div>
    <div class="info-box">
      <div class="info-row"><strong>Cebu City</strong></div>
      <div class="info-row" id="dateText">Wednesday, November 19, 2025</div>
      <div class="info-row" id="timeText">3:42 PM</div>
      <div class="weather-row">
        <span>‚òÅÔ∏è</span>
        <span id="weatherText">29.8¬∞C ‚Äî broken clouds</span>
      </div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SLIDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="slider" id="slider">
    <figure class="slide active">
      <img src="https://i.postimg.cc/PxBqyD9L/MOALBOAL-REEF-20251109-221455-0000.jpg" alt="MOALBOAL REEF">
      <figcaption>üìç MOALBOAL REEF</figcaption>
    </figure>
    <figure class="slide">
      <img src="https://i.postimg.cc/LsJRWXzN/OSLOB-WHALE-SHARK-20251110-172755-0000.jpg" alt="OSLOB WHALE SHARK">
      <figcaption>üìç OSLOB WHALE SHARK</figcaption>
    </figure>
    <figure class="slide">
      <img src="https://i.postimg.cc/htJ5W75d/TOPS-20251110-172318-0000.jpg" alt="TOPS CEBU">
      <figcaption>üìç TOPS CEBU</figcaption>
    </figure>
    <figure class="slide">
      <img src="https://i.postimg.cc/jj7mNJ6s/10000-ROSES-20251110-170913-0000.jpg" alt="10000 Roses">
      <figcaption>üìç 10,000 Roses</figcaption>
    </figure>
  </section>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VOUCHER ENTRY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="voucher">
    <input id="voucherInput" type="text" placeholder="Enter voucher code">
    <button id="connectBtn">Connect</button>
  </section>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PRICING CARDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="pricing">
    <div class="card free" data-price="‚Ç±0" data-label="Free Wi-Fi ¬∑ 30 mins/day">
      <span>‚Ç±0</span>
      <small>Free Wi-Fi</small>
      <small>30 mins/day</small>
    </div>
    <div class="card blue" data-price="‚Ç±6" data-label="2 Hours ¬∑ With pause">
      <span>‚Ç±6</span>
      <small>2 Hours</small>
      <small>With pause</small>
    </div>
    <div class="card violet" data-price="‚Ç±12" data-label="5 Hours ¬∑ With pause">
      <span>‚Ç±12</span>
      <small>5 Hours</small>
      <small>With pause</small>
    </div>
    <div class="card gold" data-price="‚Ç±23" data-label="1 Day ¬∑ No pause">
      <span>‚Ç±23</span>
      <small>1 Day</small>
      <small>No pause</small>
    </div>
    <div class="card orange" data-price="‚Ç±50" data-label="3 Days ¬∑ No pause">
      <span>‚Ç±50</span>
      <small>3 Days</small>
      <small>No pause</small>
    </div>
    <div class="card silver" data-price="‚Ç±100" data-label="7 Days ¬∑ No pause">
      <span>‚Ç±100</span>
      <small>7 Days</small>
      <small>No pause</small>
    </div>
    <div class="card plum" data-price="‚Ç±200" data-label="14 Days ¬∑ No pause">
      <span>‚Ç±200</span>
      <small>14 Days</small>
      <small>No pause</small>
    </div>
    <div class="card sunny" data-price="‚Ç±400" data-label="30 Days ¬∑ No pause">
      <span>‚Ç±400</span>
      <small>30 Days</small>
      <small>No pause</small>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SPIN & WIN SECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section class="spin-section">
    <h2>üé° Spin &amp; Win</h2>
    <p class="spin-desc">10 points = 1 spin (demo mode)</p>

    <div class="spin-wrapper">
      <canvas id="wheelCanvas" width="300" height="300"></canvas>
      <div class="pointer"></div>
    </div>

    <button id="spinBtn" class="spin-btn">Spin Now</button>
    <div id="spinStatus" class="spin-status"></div>

    <button id="myPointsBtn" class="points-btn">My Points</button>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="powered">Powered by MG Wellness Tech ‚Äî Ireneo</div>
  </footer>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MY POINTS MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="pointsModal" class="modal-layer">
    <div class="modal-backdrop"></div>
    <div class="modal-box">
      <h3>My Points</h3>
      <p><strong>Active points:</strong> <span id="activePoints">0</span></p>
      <p><strong>Total points (this year):</strong> <span id="totalPoints">0</span></p>
      <p class="modal-note">Resets automatically every January 1 ‚Ä¢ Frontend demo only</p>
      <div class="modal-actions">
        <button id="closePoints" class="btn-outline">Close</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PRICING MODAL (BUY / ENTER / CANCEL) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="pricingModal" class="modal-layer">
    <div class="modal-backdrop"></div>
    <div class="modal-box">
      <h3 id="pmTitle">Voucher details</h3>
      <p id="pmDetails"></p>
      <p class="modal-note">Buy = go to payment (soon) ¬∑ Enter = focus voucher box.</p>
      <div class="modal-actions">
        <button id="pmCancel" class="btn-outline">Cancel</button>
        <button id="pmEnter" class="btn-primary">Enter</button>
        <button id="pmBuy" class="btn-danger">Buy</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SOUND EFFECTS (local .wav files) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <!-- Folder structure: /sounds/tick.wav etc (same level as portal.html) -->
  <audio id="sndTick"     src="sounds/tick.wav"     preload="auto"></audio>
  <audio id="sndWin"      src="sounds/win.wav"      preload="auto"></audio>
  <audio id="sndJackpot"  src="sounds/jackpot.wav"  preload="auto"></audio>
  <audio id="sndTryAgain" src="sounds/try_again.wav" preload="auto"></audio>
  <audio id="sndEnd"      src="sounds/end.wav"      preload="auto"></audio>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ JAVASCRIPT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    /* ========== CONFIG: GOOGLE SHEETS WEBHOOK URL ========== */
    const SHEETS_WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbwpwUw-6KavvX4OzhZlp07tq7yczgvwkmA1aXygq7JBzuHCqWBu_KoLsmXAGZyhmV3_5w/exec"; // <-- ilisi boss

    /* ========== BASIC DOM REFERENCES ========== */
    const sidebar   = document.getElementById("sidebar");
    const overlay   = document.getElementById("overlay");
    const menuBtn   = document.getElementById("menuBtn");
    const fbNameEl  = document.getElementById("fbName");
    let   fbName    = fbNameEl ? fbNameEl.textContent.trim() : "Guest";

    /* ========== SIDEBAR MENU ========== */
    menuBtn.onclick = () => {
      sidebar.classList.add("open");
      overlay.classList.add("show");
      menuBtn.style.opacity = "0";
    };
    overlay.onclick = () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
      menuBtn.style.opacity = "1";
    };

    /* ========== GREETING ========== */
    function updateGreeting(){
      const hour = new Date().getHours();
      const g = document.getElementById("greetingText");
      if(hour < 12) g.textContent = "Good morning ‚òÄÔ∏è";
      else if(hour < 17) g.textContent = "Good afternoon üå§Ô∏è";
      else if(hour < 20) g.textContent = "Good evening üåÜ";
      else g.textContent = "Good night üåô";
    }
    updateGreeting();
    setInterval(updateGreeting, 60_000);

    /* ========== CLOCK + DATE ========== */
    function updateClock(){
      const now = new Date();
      document.getElementById("dateText").textContent =
        now.toLocaleDateString("en-PH", {
          weekday:"long",
          month:"long",
          day:"numeric",
          year:"numeric"
        });
      document.getElementById("timeText").textContent =
        now.toLocaleTimeString("en-US", {
          hour:"2-digit",
          minute:"2-digit"
        });
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* ========== WEATHER (OpenWeather) ========== */
    const WEATHER_KEY = "36f42c29dd89d9ed29d2795ef18c2ab2";
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${WEATHER_KEY}&units=metric`)
          .then(r => r.json())
          .then(d => {
            if (!d.main || !d.weather) return;
            const temp = d.main.temp;
            const w = d.weather[0];
            document.getElementById("weatherText").textContent =
              `${temp.toFixed(1)}¬∞C ‚Äî ${w.description}`;
          })
          .catch(() => {});
      });
    }

    /* ========== SLIDESHOW ========== */
    const slides = document.querySelectorAll(".slide");
    let slideIndex = 0;
    function nextSlide(){
      if (!slides.length) return;
      slides[slideIndex].classList.remove("active");
      slideIndex = (slideIndex + 1) % slides.length;
      slides[slideIndex].classList.add("active");
    }
    setInterval(nextSlide, 4000);

    /* ========== POINTS STORAGE (ACTIVE + TOTAL) ========== */
    const YEAR_KEY   = "mg_points_year";
    const ACTIVE_KEY = "mg_active_points";
    const TOTAL_KEY  = "mg_total_points";

    function loadPoints(){
      const nowYear   = new Date().getFullYear();
      const savedYear = parseInt(localStorage.getItem(YEAR_KEY) || "0", 10);
      if(savedYear !== nowYear){
        localStorage.setItem(YEAR_KEY, nowYear.toString());
        localStorage.setItem(ACTIVE_KEY, "0");
        localStorage.setItem(TOTAL_KEY, "0");
      }
      return {
        active: parseInt(localStorage.getItem(ACTIVE_KEY) || "0", 10),
        total:  parseInt(localStorage.getItem(TOTAL_KEY)  || "0", 10)
      };
    }

    function savePoints(active, total){
      localStorage.setItem(ACTIVE_KEY, active.toString());
      localStorage.setItem(TOTAL_KEY,  total.toString());
    }

    function refreshPointsUI(){
      const pts = loadPoints();
      document.getElementById("activePoints").textContent = pts.active;
      document.getElementById("totalPoints").textContent  = pts.total;
    }

    let points = loadPoints();

    /* ========== MY POINTS MODAL ========== */
    const pointsModal  = document.getElementById("pointsModal");
    const myPointsBtn  = document.getElementById("myPointsBtn");
    const sideMyPoints = document.getElementById("sideMyPoints");
    const closePoints  = document.getElementById("closePoints");

    function openPoints(){
      points = loadPoints();
      refreshPointsUI();
      pointsModal.classList.add("show");
    }
    function closePointsModal(){
      pointsModal.classList.remove("show");
    }

    myPointsBtn.onclick   = openPoints;
    sideMyPoints.onclick  = openPoints;
    closePoints.onclick   = closePointsModal;
    pointsModal.querySelector(".modal-backdrop").onclick = closePointsModal;

    /* ========== PRICING MODAL (BUY / ENTER / CANCEL) ========== */
    const pricingModal = document.getElementById("pricingModal");
    const pmTitle      = document.getElementById("pmTitle");
    const pmDetails    = document.getElementById("pmDetails");
    const pmCancel     = document.getElementById("pmCancel");
    const pmEnter      = document.getElementById("pmEnter");
    const pmBuy        = document.getElementById("pmBuy");
    const voucherInput = document.getElementById("voucherInput");

    function openPricing(price, label){
      pmTitle.textContent   = `Plan ${price}`;
      pmDetails.textContent = label;
      pricingModal.classList.add("show");
    }
    function closePricing(){
      pricingModal.classList.remove("show");
    }

    document.querySelectorAll(".card").forEach(card=>{
      const price = card.dataset.price;
      const label = card.dataset.label;
      card.addEventListener("click", ()=>openPricing(price,label));
    });

    pmCancel.onclick = closePricing;
    pricingModal.querySelector(".modal-backdrop").onclick = closePricing;
    pmEnter.onclick = () => {
      closePricing();
      voucherInput.focus();
    };
    pmBuy.onclick = () => {
      alert("Buy flow / payment coming soon (backend integration).");
    };

    /* ========== SPIN WHEEL (GCASH-ACCURATE + SOUNDS) ========== */
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const cw = canvas.width;
    const ch = canvas.height;
    const cx = cw / 2;
    const cy = ch / 2;

    const spinBtn    = document.getElementById("spinBtn");
    const spinStatus = document.getElementById("spinStatus");

    const prizes = [
      "2 Hours",
      "5 Hours",
      "12 Hours",
      "TRY AGAIN",
      "+1 Point",
      "+2 Points",
      "+4 Points",
      "+8 Points"
    ];

    const sliceCount = prizes.length;
    const sliceAngle = (2 * Math.PI) / sliceCount;

    /* DRAW WHEEL */
    function drawWheel() {
      const colors = [
        "#ffeb3b", "#ff7043", "#29b6f6", "#ab47bc",
        "#66bb6a", "#ffca28", "#ef5350", "#26a69a"
      ];

      ctx.clearRect(0, 0, cw, ch);

      for (let i = 0; i < sliceCount; i++) {
        const start = i * sliceAngle;
        const end = start + sliceAngle;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.fillStyle = colors[i % colors.length];
        ctx.arc(cx, cy, 140, start, end);
        ctx.closePath();
        ctx.fill();

        // Labels inside slice
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(start + sliceAngle / 2);

        ctx.textAlign = "center";
        ctx.fillStyle = "#002b55";
        ctx.font = "bold 15px Arial";
        ctx.fillText(prizes[i], 90, 5);

        ctx.restore();
      }
    }
    drawWheel();

    /* ========== SOUND HELPERS ========== */
    const sndTick     = new Audio("/static/sounds/tick.wav");
    const sndWin      = new Audio("/static/sounds/win.wav");
    const sndEnd      = new Audio("/static/sounds/end.wav");
    const sndTry      = new Audio("/static/sounds/try_again.wav");
    const sndJackpot  = new Audio("/static/sounds/jackpot.wav");

    function playSound(audioEl){
      if (!audioEl) return;
      try{
        audioEl.currentTime = 0;
        audioEl.play();
      }catch(e){
        console.warn("Audio blocked:", e);
      }
    }

    /* ========== SPIN LOGIC ‚Äì 100% POINTER + SOUNDS ========== */
    let currentRotation = 0;
    let spinning = false;

    spinBtn.onclick = () => {
      if (spinning) return;
      spinning = true;

      spinStatus.textContent = "Spinning‚Ä¶";

      // first tick right away (user interaction)
      playSound(sndTick);

      const idx   = Math.floor(Math.random() * sliceCount);   // random prize index
      const extra = 6;                                        // full spins
      const sliceDeg = 360 / sliceCount;

      // Pointer at TOP = 270¬∞
      const targetDeg = (sliceDeg * idx) + (sliceDeg / 2);
      const finalDeg  = (extra * 360) + 270 - targetDeg;
      const finalRad  = finalDeg * Math.PI / 180;

      currentRotation += finalRad;

      const spinMs = 4500;
      canvas.style.transition = `transform ${spinMs/1000}s cubic-bezier(0.12,0.6,0.1,1)`;
      canvas.style.transform  = `rotate(${currentRotation}rad)`;

      // Ticking sound while spinning
      let tickTimer = setInterval(() => {
        playSound(sndTick);
      }, 90);

      setTimeout(() => {
        clearInterval(tickTimer);

        const result = prizes[idx];
        spinStatus.textContent = "üéâ Result: " + result;

        // Determine points
        let addPoints = 0;
        const match = result.match(/^\+(\d+)\s+Point/);
        if (match) {
          addPoints = parseInt(match[1], 10);
          points = loadPoints();
          points.active += addPoints;
          points.total  += addPoints;
          savePoints(points.active, points.total);
        }

        // Decide which sound to play at the end
        if (result === "TRY AGAIN") {
          playSound(sndTryAgain);
        } else if (addPoints >= 8) {
          playSound(sndJackpot);
        } else {
          playSound(sndWin);
        }

        // small end "click"
        setTimeout(() => playSound(sndEnd), 250);

        // log to Google Sheets (if URL configured)
        if (SHEETS_WEBHOOK_URL && SHEETS_WEBHOOK_URL.startsWith("http")) {
          const payload = {
            branch:       "Branch 1 - Cogon Pardo",
            source:       "spin",
            timestamp:    new Date().toISOString(),
            fb_name:      fbName,
            prize:        result,
            add_points:   addPoints,
            active_points: points.active,
            total_points:  points.total
          };
          logSpinToSheet(payload);
        }

        spinning = false;
      }, spinMs + 200);
    };

    /* ========== LOGGING FUNCTION ========== */
    function logSpinToSheet(data) {
      try {
        fetch(SHEETS_WEBHOOK_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
      } catch (e) {
        console.warn("Log error:", e);
      }
    }
  </script>

<!-- SOUND FILES -->
<audio id="sndTick" src="/monsalud-portal/static/sounds/tick.wav" preload="auto"></audio>
<audio id="sndWin" src="/monsalud-portal/static/sounds/win.wav" preload="auto"></audio>
<audio id="sndJackpot" src="/monsalud-portal/static/sounds/jackpot.wav" preload="auto"></audio>
<audio id="sndTryAgain" src="/monsalud-portal/static/sounds/try_again.wav" preload="auto"></audio>
<audio id="sndEnd" src="/monsalud-portal/static/sounds/end.wav" preload="auto"></audio>
</body>
</html>
